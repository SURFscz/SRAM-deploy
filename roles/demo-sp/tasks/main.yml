---
- include_role:
    name: "simplesamlphp"
    public: true
  vars:
    simplesaml_name: "{{demosp_name}}"
    simplesaml_user: "{{demosp_user}}"
    simplesaml_group: "{{demosp_group}}"

- include_role:
    name: "nginx"

- name: write tools private key
  copy:
    content: "{{tools_https_cert.priv}}"
    dest: "{{ ssl_certs_dir }}/tools_https.key"
    owner: "root"
    group: "ssl-cert"
    mode: "0640"
  no_log: "{{sram_ansible_nolog}}"

- name: write tools certificate
  copy:
    content: "{{tools_https_cert.pub}}"
    dest: "{{ ssl_certs_dir }}/tools_https.crt"
    owner: "root"
    group: "root"
    mode: 0644


- name: Install nginx config
  template:
    src: "nginx.conf.j2"
    dest: "/etc/nginx/sites-enabled/01-sram-demosp.conf"
  notify: "restart nginx"
