---
- name: "install packages"
  apt:
    name: "python3-zeep"
    state: "present"

- name: "create group"
  group:
    name: "sram-tools"
    state: "present"

- name: "create directories"
  file:
    path: "{{item}}"
    state: "directory"
    mode: "0775"
    owner: "root"
    group: "sram-tools"
  with_items:
    - "{{sram_tools_basedir}}"
    - "{{sram_tools_basedir}}/bin"

- name: "install rappportage script"
  template:
    src: "rapportage.py.j2"
    dest: "{{sram_tools_basedir}}/bin/rapportage.py"
    owner: "root"
    group: "sram-tools"
    mode: "0750"

- name: Copy service files
  template:
    src: "{{item}}.j2"
    dest: "/etc/systemd/system/{{item}}"
  with_items:
    - "sram-rapportage.service"
    - "sram-rapportage.timer"
  notify:
    - "enable rapportage job"
    - "restart rapportage job"
